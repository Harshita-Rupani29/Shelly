{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "name": "code-review",
  "description": "Automated code review workflow for @juspay/shelly",
  "version": "1.0.0",
  "variables": {
    "file": {
      "type": "string",
      "required": true,
      "description": "Path to the file to review"
    },
    "language": {
      "type": "string",
      "required": false,
      "default": "auto",
      "description": "Programming language (auto-detected if not specified)"
    },
    "reviewType": {
      "type": "string",
      "required": false,
      "default": "comprehensive",
      "enum": ["quick", "comprehensive", "security", "performance"],
      "description": "Type of review to perform"
    }
  },
  "steps": [
    {
      "id": "analysis",
      "name": "Analyze Code Structure",
      "prompt": "Perform a {{reviewType}} review of the following {{language}} code and identify:\n1. Code structure and organization\n2. Potential bugs or logic errors\n3. Code smells and anti-patterns\n4. Naming conventions and readability issues\n\nCode:\n```{{language}}\n{{file}}\n```",
      "outputVariable": "codeAnalysis"
    },
    {
      "id": "suggestions",
      "name": "Generate Improvement Recommendations",
      "prompt": "Based on the analysis:\n{{codeAnalysis}}\n\nProvide specific, actionable recommendations for:\n1. Bug fixes (if any)\n2. Code quality improvements\n3. Performance optimizations\n4. Security considerations\n5. Best practices alignment\n\nFormat each suggestion with priority (High/Medium/Low) and estimated effort.",
      "outputVariable": "suggestions",
      "dependsOn": ["analysis"]
    },
    {
      "id": "refactored",
      "name": "Generate Improved Code",
      "prompt": "Apply the high-priority suggestions from:\n{{suggestions}}\n\nTo the original code:\n```{{language}}\n{{file}}\n```\n\nProvide the refactored code with inline comments explaining significant changes.",
      "outputVariable": "refactoredCode",
      "dependsOn": ["suggestions"]
    },
    {
      "id": "summary",
      "name": "Generate Review Summary",
      "prompt": "Create a concise code review summary including:\n1. Overall code quality score (1-10)\n2. Key issues found\n3. Recommendations applied\n4. Remaining technical debt\n\nAnalysis: {{codeAnalysis}}\nSuggestions: {{suggestions}}",
      "outputVariable": "reviewSummary",
      "dependsOn": ["analysis", "suggestions"]
    }
  ],
  "output": {
    "format": "markdown",
    "sections": ["reviewSummary", "suggestions", "refactoredCode"]
  }
}
